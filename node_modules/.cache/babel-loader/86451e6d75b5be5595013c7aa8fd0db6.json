{"ast":null,"code":"import fire from '../config/firebaseConfig';\nimport refresh4User from './refresh4User';\nimport getAllUsers from './getAllUsers';\nimport getAllRegionTasks from './getAllRegionTasks';\nimport Router from 'next/router';\nexport default function checkAuthAndRefresh(dispatch) {\n  fire.auth().onAuthStateChanged(function (user) {\n    var db = fire.firestore();\n    console.log(user);\n\n    if (user) {\n      db.collection(\"users\").doc(user.uid).get().then(function (doc) {\n        dispatch({\n          type: 'LOGIN',\n          user: doc.data(),\n          uid: user.uid\n        });\n\n        if (doc.data().admin == false) {\n          refresh4User(dispatch, doc.data().region, user.uid);\n        } else {\n          getAllUsers(dispatch);\n          getAllRegionTasks(dispatch, doc.data().region);\n        }\n\n        dispatch({\n          type: 'AUTHCHECKED'\n        });\n      });\n    } else {\n      Router.push('/login');\n      dispatch({\n        type: 'AUTHCHECKED'\n      });\n    }\n  });\n}","map":{"version":3,"sources":["C:\\Users\\Oz\\Desktop\\leket\\leket\\dbActions\\checkAuth.js"],"names":["fire","refresh4User","getAllUsers","getAllRegionTasks","Router","checkAuthAndRefresh","dispatch","auth","onAuthStateChanged","user","db","firestore","console","log","collection","doc","uid","get","then","type","data","admin","region","push"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,0BAAjB;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,OAAOC,MAAP,MAAmB,aAAnB;AAEA,eAAe,SAASC,mBAAT,CAA6BC,QAA7B,EAAuC;AAClDN,EAAAA,IAAI,CAACO,IAAL,GAAYC,kBAAZ,CAA+B,UAACC,IAAD,EAAU;AACrC,QAAMC,EAAE,GAAGV,IAAI,CAACW,SAAL,EAAX;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAYJ,IAAZ;;AACA,QAAIA,IAAJ,EAAU;AACNC,MAAAA,EAAE,CAACI,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BN,IAAI,CAACO,GAAhC,EAAqCC,GAArC,GAA2CC,IAA3C,CAAgD,UAACH,GAAD,EAAS;AACrDT,QAAAA,QAAQ,CAAC;AAAEa,UAAAA,IAAI,EAAE,OAAR;AAAiBV,UAAAA,IAAI,EAAEM,GAAG,CAACK,IAAJ,EAAvB;AAAmCJ,UAAAA,GAAG,EAAEP,IAAI,CAACO;AAA7C,SAAD,CAAR;;AACA,YAAID,GAAG,CAACK,IAAJ,GAAWC,KAAX,IAAoB,KAAxB,EAA+B;AAC3BpB,UAAAA,YAAY,CAACK,QAAD,EAAWS,GAAG,CAACK,IAAJ,GAAWE,MAAtB,EAA8Bb,IAAI,CAACO,GAAnC,CAAZ;AACH,SAFD,MAEO;AACHd,UAAAA,WAAW,CAACI,QAAD,CAAX;AACAH,UAAAA,iBAAiB,CAACG,QAAD,EAAWS,GAAG,CAACK,IAAJ,GAAWE,MAAtB,CAAjB;AACH;;AACDhB,QAAAA,QAAQ,CAAC;AAAEa,UAAAA,IAAI,EAAE;AAAR,SAAD,CAAR;AACH,OATD;AAUH,KAXD,MAWO;AACHf,MAAAA,MAAM,CAACmB,IAAP,CAAY,QAAZ;AACAjB,MAAAA,QAAQ,CAAC;AAAEa,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAR;AACH;AACJ,GAlBD;AAmBH","sourcesContent":["import fire from '../config/firebaseConfig'\r\nimport refresh4User from './refresh4User'\r\nimport getAllUsers from './getAllUsers'\r\nimport getAllRegionTasks from './getAllRegionTasks'\r\nimport Router from 'next/router'\r\n\r\nexport default function checkAuthAndRefresh(dispatch) {\r\n    fire.auth().onAuthStateChanged((user) => {\r\n        const db = fire.firestore();\r\n        console.log(user);\r\n        if (user) {\r\n            db.collection(\"users\").doc(user.uid).get().then((doc) => {\r\n                dispatch({ type: 'LOGIN', user: doc.data(), uid: user.uid });\r\n                if (doc.data().admin == false) {\r\n                    refresh4User(dispatch, doc.data().region, user.uid);\r\n                } else {\r\n                    getAllUsers(dispatch);\r\n                    getAllRegionTasks(dispatch, doc.data().region);\r\n                }\r\n                dispatch({ type: 'AUTHCHECKED' });\r\n            });\r\n        } else {\r\n            Router.push('/login');\r\n            dispatch({ type: 'AUTHCHECKED' });\r\n        }\r\n    });\r\n}"]},"metadata":{},"sourceType":"module"}