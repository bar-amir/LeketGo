{"ast":null,"code":"import fire from '../config/firebaseConfig';\nimport XLSX from 'xlsx';\nexport default function handleFileUpload(file) {\n  var reader = new FileReader();\n\n  reader.onload = function (evt) {\n    var bstr = evt.target.result;\n    var wb = XLSX.read(bstr, {\n      type: 'binary'\n    });\n    var wsname = wb.SheetNames[0];\n    var ws = wb.Sheets[wsname];\n    var data = XLSX.utils.sheet_to_csv(ws, {\n      header: 1\n    });\n    addTasksToDB(data);\n    console.log(\"Data from file was read succesfully.\");\n  };\n\n  reader.readAsBinaryString(file);\n  console.log(file);\n}\n\nfunction addTasksToDB(data) {\n  var taskCollection = fire.firestore().collection('tasks');\n  var timeStampCreator = fire.firebase_.firestore.Timestamp; //.firestore.Timestamp;\n\n  console.log(timeStampCreator);\n  var rows = data.split(/[\\r\\n|\\n]+/);\n\n  for (var i = 1; i < rows.length - 1; i++) {\n    var row = text2arr(rows[i]);\n    console.log(row);\n    var timeStamp = timeStampCreator.fromDate(new Date(row[2] + 'T' + row[3]));\n    taskCollection.doc(row[0] + '-' + row[2]).set({\n      // row[0]-taskID, row[2]-date. create unique id for each task.\n      name: row[1],\n      timestamp: timeStamp,\n      city: row[4],\n      address: row[5],\n      \"contact number\": row[6],\n      \"contact name\": row[7],\n      notes: row[8],\n      region: row[9],\n      longitude: row[10] == \"\" ? \"\" : Number(row[10]),\n      latitude: row[11] == \"\" ? \"\" : Number(row[11]),\n      volunteerUid: null,\n      reportFilled: false,\n      collected: false\n    });\n  }\n}\n\nfunction text2arr(text) {\n  var arr = [];\n  var cell = '';\n  var between = false;\n\n  for (var i = 0; i < text.length; i++) {\n    if (text[i] == '\"') {\n      between = !between;\n    } else {\n      if (text[i] == ',') {\n        if (between) {\n          cell += text[i];\n        } else {\n          arr.push(cell);\n          cell = '';\n        }\n      } else {\n        cell += text[i];\n      }\n    }\n  }\n\n  arr.push(cell);\n  return arr;\n}","map":null,"metadata":{},"sourceType":"module"}